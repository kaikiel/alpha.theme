<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="alpha.theme">
<body>
<metal:content-core fill-slot="content-core">
<metal:content-core define-macro="content-core"
                    tal:define="toc context/table_of_contents|nothing;">
  <div class="user-login-area mb-70">
    <div class="container">
      <div class="row" tal:condition="view/checkAdmin" >
        <a class="oval-btn" href="@@usergroup-userprefs" i18n:translate="">Back to manage user</a>
      </div>
      <div class="row">
        <div class="col-lg-12">
          <div class="login-title text-center mb-30">
            <h2 i18n:translate="">Account Details</h2>
          </div>
        </div>
        <div class="col-lg-offset-2 col-lg-8 col-md-offset-2 col-md-8 col-sm-12 col-xs-12">
          <form method="post" >
            <div class="billing-fields">
              <div class="row">
                <h1 class="documentFirstHeading" i18n:translate="">Your Personal Details</h1>
                <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12" tal:condition="view/checkAdmin">
                  <label i18n:translate="">promoCode</label>
                  <input type="text" name="promoCode" id="promoCode" value="${python: view.getCurrentUser().getProperty('promoCode')}"
                         oninput="this.className = '';this.setCustomValidity('');" onblur="checkPromoCode()" pattern="[0-9]{6,}"  />
                </div>
                <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12" tal:condition="view/checkAdmin">
                  <label><span i18n:translate="">group</span><span class="must">*</span></label>
                  <select class="form-control" name="group" id="group" required>
                    <option i18n:translate="" disabled selected value="">Please Choice</option>
                    <option value="level_D" i18n:translate="">level_D</option>
                    <option value="level_C" i18n:translate="">level_C</option>
                    <option value="level_B" i18n:translate="">level_B</option>
                    <option value="level_A" i18n:translate="">level_A</option>
                  </select>
                </div>
                <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                  <div class="single-register">
                    <label for="fName"><span i18n:translate="">First Name</span><span class="must">*</span></label>
                    <input type="text" name="fName" id="fName" value="${python: view.getCurrentUser().getProperty('fName')}" required/>
                  </div>
                </div>
                <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                  <div class="single-register">
                    <label for="lName"><span i18n:translate="">Last Name</span><span class="must">*</span></label>
                    <input type="text" name="lName" id="lName" value="${python: view.getCurrentUser().getProperty('lName')}" required/>
                  </div>
                </div>
                <div class="col-xs-12">
                  <div class="single-register">
                    <label for="email"><span i18n:translate="">Email Address</span><span class="must">*</span></label>
                    <input type="hidden" id="id_email" name="id_email" value="${python: view.getCurrentUser().id}">
                    <input type="email" name="email" id="email" value="${python: view.getCurrentUser().getProperty('email')}" required onblur="checkEmail()" />
                  </div>
                </div>
                <div class="col-sm-6 col-xs-12">
                  <div class="single-register">
                    <label for="telephone"><span i18n:translate="">Telephone</span><span class="must">*</span></label>
                    <input type="text" name="telephone" id="telephone" value="${python: view.getCurrentUser().getProperty('telephone')}" required/>
                  </div>
                </div>
                <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                  <div class="single-register">
                    <label for="fax" i18n:translate="">Fax</label>
                    <input type="text" name="fax" id="fax" value="${python: view.getCurrentUser().getProperty('fax')}"/>
                  </div>
                </div>
                <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12" 
                     tal:condition="python: view.getCurrentUser().getProperty('promoCode') and (not view.checkAdmin())">
                  <div class="single-register">
                    <label i18n:translate="">promoCode</label>
                    <input type="text" value="${python: view.getCurrentUser().getProperty('promoCode')}" readonly/>
                  </div>
                </div>
              </div>
              <h1 class="documentFirstHeading" i18n:translate="">Your Address</h1>
              <div class="single-register">
                <label for="company" i18n:translate="">Company</label>
                <input type="text" name="company" id="company" value="${python: view.getCurrentUser().getProperty('company')}"/>
              </div>
              <div class="single-register">
                <label for="address1"><span i18n:translate="">Address1</span><span class="must">*</span></label>
                <input type="text" name="address1" id="address1" value="${python: view.getCurrentUser().getProperty('address1')}" required />
              </div>
              <div class="single-register">
                <label for="address2" i18n:translate="">Address2</label>
                <input type="text" name="address2" id="address2" value="${python: view.getCurrentUser().getProperty('address2')}" />
              </div>
              <div class="row">
                <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                  <div class="single-register">
                    <label for="city"><span i18n:translate="">Town/City</span><span class="must">*</span></label>
                    <input type="text" name="city" id="city" value="${python: view.getCurrentUser().getProperty('city')}" required />
                  </div>
                </div>
                <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                  <div class="single-register">
                    <label for="zip"><span i18n:translate="">Postcode/zip</span><span class="must">*</span></label>
                    <input type="text" name="zip" id="zip" value="${python: view.getCurrentUser().getProperty('zip')}" required />
                  </div>
                </div>
                <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                  <input type="hidden" name="country" value="臺灣"/>
                </div>
                <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                  <input type="hidden" name="state" value="臺灣"/>
                </div>
              </div>
              <h1 class="documentFirstHeading" i18n:translate="">Newsletter</h1>
              <div class="single-register single-register-3">
                <label class="inline" id="newsletterCheck" 
                       data-newsletter="${python: view.getCurrentUser().getProperty('newsletter')}" 
                       i18n:translate="">Subscribe</label>
                <label for="newsletter_yes">
                <input type="radio" id="newsletter_yes" name="newsletter" value="true"> <span i18n:translate="">Yes</span>
                </label>
                <label for="newsletter_no">
                <input type="radio" id="newsletter_no" name="newsletter" value="false"> <span i18n:translate="">No</span>
                </label>
              </div>
              <div style="text-align: right;">
                <input type="hidden" name="widget-form-btn" value="widget-form-btn"/>
                <input type="submit" class="oval-btn" i18n:attributes="value" value="submit"/>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <script>
    document.onreadystatechange = function(){
      group = document.getElementById('group')
      if(group) group.value = "${python: view.getCurrentUser().getProperty('group')}"

    };
    window.onload = function (check){
      var newsletter = document.getElementById('newsletterCheck');
      var check = newsletter.getAttribute('data-newsletter');
      switch(check){
          case 'true':
              document.getElementById('newsletter_yes').checked = true;
              document.getElementById('newsletter_no').checked = false;
              break;
          case 'false':
              document.getElementById('newsletter_yes').checked = false;
              document.getElementById('newsletter_no').checked = true;
              break;
      }
    };

  function checkEmail(){
    var email = event.target.value;
    var id_email = document.getElementById("id_email").value;
    if(email){
      var form = new FormData(this);
      form.append("email", email);
      form.append("id_email", id_email);
      $.ajax({
          method: "POST",
          url: location.href.replace("personal_details", "register_form"),
          processData: false,
          contentType: false,
          mimeType: "multipart/form-data",
          data: form,
      }).done(function(response) {
          if(response == "1"){
              document.getElementById("email").setCustomValidity("");
          }else{
              document.getElementById("email").setCustomValidity("${view/emailStr}");
          }
      }); 
    }
  }

  function checkPromoCode(){
    var promoCode = event.target.value;
    if(promoCode){
      var form = new FormData(this);
      form.append("promoCode", promoCode);
      $.ajax({
          method: "POST",
          url: location.href.replace("personal_details", "register_form"),
          processData: false,
          contentType: false,
          mimeType: "multipart/form-data",
          data: form,
      }).done(function(response) {
          if(response == "1"){
              document.getElementById("promoCode").setCustomValidity("");
          }else{
              document.getElementById("promoCode").setCustomValidity("${view/promoCodeStr}");
          }
      }); 
    }
  }
  </script>

</metal:content-core>
</metal:content-core>
</body>
</html>
