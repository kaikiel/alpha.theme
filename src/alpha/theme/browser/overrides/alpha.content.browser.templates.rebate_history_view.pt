<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
    xmlns:tal="http://xml.zope.org/namespaces/tal"
    xmlns:metal="http://xml.zope.org/namespaces/metal"
    xmlns:i18n="http://xml.zope.org/namespaces/i18n"
    xmlns:v-on="http://vuejs.org"
    lang="en"
    metal:use-macro="context/main_template/macros/master"
    i18n:domain="alpha.theme">
<body>
<metal:content-core fill-slot="content-core">
<metal:content-core define-macro="content-core"
                    tal:define="toc context/table_of_contents|nothing;">
<style>
  td {
    min-width: 65pt;
  }

  tr.drop td {
    background: #ecf2f7d1;
    border-bottom: 1px solid;
  }

  tr.drop.status2 {
      background-color: #828282;
  }

  tr.drop.status3 {
      background-color: black;
  }
</style>
  <metal:listingmacro>
    <tal:results define="batch view/batch;">
      <tal:listing>

        <form method="POST">
          <div class="row">
            <div class="col-xs-12 col-sm-4">
              <div class="form-group">
                <label for="order-id-input" class="col-2 col-form-label" i18n:translate="">Order ID</label>
                <div class="col-10">
                  <input class="form-control" type="text" name="order_id" id="order-id">
                </div>
              </div>
            </div>
            <div class="col-xs-12 col-sm-4">
              <div class="form-group">
                <label for="start-date-input" class="col-2 col-form-label">Start Date</label>
                <div class="col-10">
                  <input class="form-control" type="date" name="start_date" id="start-date-input">
                </div>
              </div>
            </div>
            <div class="col-xs-12 col-sm-4">
              <div class="form-group">
                <label for="end-date-input" class="col-2 col-form-label">End Date</label>
                <div class="col-10">
                  <input class="form-control" type="date" name="end_date" id="end-date-input">
                </div>
              </div>
            </div>
            <div class="col-xs-12">
              <input class="oval-btn" type="submit" value="Search" style="float:right;" i18n:attributes="value;">
            </div>
          </div>
        </form>

        <form method="POST">
        <div class="cart-main-area mb-70">
          <div class="container">
            <div class="row">
              <div class="col-lg-12">
                <div class="wishlist-content">
                  <div class="wishlist-title form-inline row">
                    <div class="col-xs-10">
                      <h2 i18n:translate="">Rebate History</h2>
                    </div>
                    <div class="col-xs-2">
                      <form method="GET">
                        <div class="form-group">
                          <label for="end-date-input" class="col-2 col-form-label" i18n:translate="">Show</label>
                          <div class="col-10">
                            <input class="form-control" name="b_size" type="number" 
                                   value="${view/b_size}" min="0" onblur="submitB_size()">
                          </div>
                        </div>
                      </form>
                    </div>
                  </div>
                  <div class="wishlist-table table-content table-responsive" tal:condition="batch">
                    <table>
                      <tbody>
                          <tr>
                            <th style="width:40%;" class="product-name" colspan="2" i18n:translate="">Order ID</th>
                            <th style="width:40%;" class="product-name" colspan="2" i18n:translate="">Date</th>
                            <th style="width:20%;" class="product-name" colspan="2" i18n:translate="">Total Rebate</th>
                          </tr>
                        <tal:repeat tal:repeat="order batch">
                          <tr data-toggle="collapse" data-target=".order${repeat/order/number}">
                            <td colspan="2" class="product-name">${order/order_id}</td>
                            <td colspan="2" class="product-name">${order/order_date}</td>
                            <td colspan="2" class="product-name">${order/total_rebate}</td>
                          </tr>
                          <tr class="collapse order${repeat/order/number} drop">
                            <th class="product-name" i18n:translate="">Product Name</th>
                            <th class="product-name" i18n:translate="">Qty</th>
                            <th class="product-name" i18n:translate="">Rebate</th>
                            <th class="product-name" i18n:translate="">Rebate Status</th>
                            <th class="product-name" tal:condition="view/checkAdmin" i18n:translate="">Return</th>
                            <th class="product-name" tal:condition="view/checkAdmin" i18n:translate="">Clear</th>
                          </tr>
                        <tal:rebate tal:repeat="item order/order_items">
                          <tr class="collapse order${repeat/order/number} drop status${item/rebate_status}">
                            <td class="product-name">${item/product_name}</td>
                            <td class="product-name">${item/qty}</td>
                            <td class="product-name">${item/rebate}</td>
                            <td class="product-name">${python: view.getStatusStr(item['rebate_status'])}</td>
                            <td class="product-name" tal:condition="view/checkAdmin">
                              <input type="checkbox" name="return:list" value="${item/id}" />
                            </td>
                            <td class="product-name" tal:condition="view/checkAdmin">
                              <input type="checkbox" name="clear:list" value="${item/id}" />
                            </td>
                          </tr>
                        </tal:rebate>
                        </tal:repeat>
                      </tbody>
                    </table>
                  </div>
                  <div tal:condition="view/checkAdmin">
                    <input type="hidden" name="widget-form-btn" value="widget-admin-submit">
                    <button style="float:right;" type="submit" class="oval-btn" i18n:translate="">Submit</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        </form>
        <!-- pagination-area-start -->
        <div class="pagination-area">
          <div class="pagination-number">
            <div metal:use-macro="context/batch_macros/macros/navigation" />
          </div>
        </div>
        <!-- pagination-area-end -->

      </tal:listing>

      <metal:empty>
        <p class="discreet"
            tal:condition="not: python: view.batch()"
            i18n:translate="">
          No results were found.
        </p>
      </metal:empty>

    </tal:results>
  </metal:listingmacro>

<script>
    function submitB_size(){
        searchList = location.search.split('&')
        b_size = event.srcElement.value
        searchList.forEach(function(searchStr, i){
            if(searchStr.includes('b_size'))
                searchList.pop(i)
        })
        searchList.push('&b_size='+b_size)
        searchStr = searchList.join('')
        b_size > 0 ? location.replace(searchStr) : ''
    }
</script>

</metal:content-core>
</metal:content-core>

</body>
</html>


